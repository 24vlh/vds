/************************************************************
 * VLAH DESIGN SYSTEM (VDS) - Progress & Stepper Indicators
 *
 *  Responsibilities:
 *    - Provide linear progress bars (determinate + indeterminate)
 *    - Support semantic states and density variants
 *    - Offer stepper indicators for multi-step flows
 *
 *  System Notes:
 *    - Pure CSS; JS only updates width or active states
 *    - Fully token-driven for sizing and colour
 ************************************************************/

/* ---------------------------------------------------------
   1. PROGRESS TOKENS
--------------------------------------------------------- */
[data-vds-progress],
.vds-progress {
    --progress-height-sm: 0.35rem;
    --progress-height-md: var(--space-2);
    --progress-height-lg: 0.9rem;
    --progress-radius: var(--radius-sm);
    --progress-track-bg: var(--color-muted-bg);
    --progress-track-border: transparent;
    --progress-fill: var(--color-accent);
    --progress-label-color: var(--color-text-muted);
    --progress-value-color: var(--color-text);
    --progress-meta-color: var(--color-text-muted);

    --stepper-gap: var(--space-6);
    --stepper-marker-size: var(--space-6);
    --stepper-line-size: 2px;
    --stepper-line: var(--color-border-subtle);
    --stepper-marker-bg: var(--color-surface);
    --stepper-marker-border: var(--color-border-subtle);
    --stepper-marker-text: var(--color-text);
    --stepper-active: var(--color-accent);
    --stepper-title-bg: var(--color-surface);
}

/* ---------------------------------------------------------
   2. LINEAR PROGRESS
--------------------------------------------------------- */
.progress-stack {
    display: grid;
    grid-gap: var(--space-2);
    gap: var(--space-2);
    width: 100%;
}

.progress-stack--compact {
    gap: var(--space-1_5);
}

.progress__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
}

.progress__label {
    font-size: var(--text-xs);
    color: var(--progress-label-color);
}

.progress__value {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--progress-value-color);
}

.progress__meta {
    font-size: var(--text-xs);
    color: var(--progress-meta-color);
}

.progress,
.progress__track {
    position: relative;
    width: 100%;
    height: var(--progress-height-md);
    border-radius: var(--progress-radius);
    background: var(--progress-track-bg);
    border: 1px solid var(--progress-track-border);
    overflow: hidden;
}

.progress__bar {
    height: 100%;
    width: 0%;
    width: var(--progress-value, 0%);
    border-radius: inherit;
    background: var(--progress-fill);
    transition: width var(--transition-normal);
}

[data-vds-progress] .progress--sm, .vds-progress .progress--sm, [data-vds-progress] .progress--sm .progress__track, .vds-progress .progress--sm .progress__track {
    height: var(--progress-height-sm);
}

[data-vds-progress] .progress--lg, .vds-progress .progress--lg, [data-vds-progress] .progress--lg .progress__track, .vds-progress .progress--lg .progress__track {
    height: var(--progress-height-lg);
}

[data-vds-progress] .progress--outlined, .vds-progress .progress--outlined {
    --progress-track-border: var(--color-border-subtle);
}

[data-vds-progress] .progress--pill, .vds-progress .progress--pill {
    --progress-radius: var(--radius-full);
}

[data-vds-progress] .progress--striped .progress__bar, .vds-progress .progress--striped .progress__bar {
    background-image: linear-gradient(
            45deg,
            rgba(255, 255, 255, 0.2) 25%,
            rgba(255, 255, 255, 0) 25%,
            rgba(255, 255, 255, 0) 50%,
            rgba(255, 255, 255, 0.2) 50%,
            rgba(255, 255, 255, 0.2) 75%,
            rgba(255, 255, 255, 0) 75%,
            rgba(255, 255, 255, 0)
    );
    background-size: 1.2rem 1.2rem;
}

[data-vds-progress] .progress--animated .progress__bar, .vds-progress .progress--animated .progress__bar {
    animation: vds-progress-stripes 0.9s linear infinite;
}

[data-vds-progress] .progress--indeterminate .progress__bar, .vds-progress .progress--indeterminate .progress__bar {
    width: 35%;
    animation: progress-indeterminate 1.4s ease infinite;
}

@keyframes vds-progress-stripes {
    0% {
        background-position: 1.2rem 0;
    }
    100% {
        background-position: 0 0;
    }
}

@keyframes progress-indeterminate {
    0% {
        transform: translateX(-120%);
    }
    100% {
        transform: translateX(260%);
    }
}

/* ---------------------------------------------------------
   3. PROGRESS SEMANTICS
--------------------------------------------------------- */
[data-vds-progress] .progress--success, .vds-progress .progress--success {
    --progress-fill: var(--color-success);
}

[data-vds-progress] .progress--info, .vds-progress .progress--info {
    --progress-fill: var(--color-info);
}

[data-vds-progress] .progress--warning, .vds-progress .progress--warning {
    --progress-fill: var(--color-warning);
}

[data-vds-progress] .progress--danger, .vds-progress .progress--danger {
    --progress-fill: var(--color-danger);
}

/* ---------------------------------------------------------
   4. STEPPER
--------------------------------------------------------- */
.stepper {
    display: flex;
    gap: var(--stepper-gap);
    align-items: flex-start;
    padding: var(--space-5);
}

.stepper__item {
    position: relative;
    display: flex;
    gap: var(--space-3);
    flex: 1 1 0;
    min-width: 0;
}

.stepper__item:not(:last-child)::after {
    content: "";
    position: absolute;
    top: calc(var(--stepper-marker-size) / 2);
    left: calc(var(--stepper-marker-size) + var(--space-3));
    right: calc(-1 * var(--stepper-gap) + (var(--stepper-marker-size) / 2));
    height: var(--stepper-line-size);
    background: var(--stepper-line);
    z-index: 0;
}

.stepper__marker {
    width: var(--stepper-marker-size);
    height: var(--stepper-marker-size);
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--stepper-marker-border);
    background: var(--stepper-marker-bg);
    color: var(--stepper-marker-text);
    font-size: var(--text-xs);
    font-weight: 600;
    flex-shrink: 0;
    z-index: 1;
}

.stepper__content {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    position: relative;
    z-index: 1;
}

.stepper__title {
    padding-right: var(--space-2);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
    align-self: flex-start;
    background: var(--stepper-title-bg);
    -webkit-box-decoration-break: clone;
            box-decoration-break: clone;
}

.stepper__desc {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
}

.stepper__item--active .stepper__marker {
    border-color: var(--stepper-active);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--stepper-active) 30%, transparent);
    color: var(--stepper-active);
}

.stepper__item--complete .stepper__marker {
    border-color: var(--color-success);
    background: var(--color-success);
    color: var(--color-on-success);
}

.stepper__item--disabled .stepper__content {
    opacity: 0.5;
    pointer-events: none;
}

.stepper__item--disabled .stepper__marker {
    pointer-events: none;
}

.stepper--compact {
    --stepper-gap: var(--space-4);
    --stepper-marker-size: var(--space-5);
}

/* ---------------------------------------------------------
   5. VERTICAL STEPPER
--------------------------------------------------------- */
.stepper--vertical {
    flex-direction: column;
    gap: var(--space-4);
}

.stepper--vertical .stepper__item {
    padding-left: calc(var(--stepper-marker-size) + var(--space-3));
}

.stepper--vertical .stepper__marker {
    position: absolute;
    left: 0;
    top: 0;
}

.stepper--vertical .stepper__item:not(:last-child)::after {
    left: calc(var(--stepper-marker-size) / 2);
    top: var(--stepper-marker-size);
    right: auto;
    width: var(--stepper-line-size);
    height: calc(100% + var(--space-4));
}

@media (max-width: 768px) {
    .stepper {
        flex-direction: column;
    }

    .stepper__item {
        padding-left: calc(var(--stepper-marker-size) + var(--space-3));
    }

    .stepper__marker {
        position: absolute;
        left: 0;
        top: 0;
    }

    .stepper__item:not(:last-child)::after {
        left: calc(var(--stepper-marker-size) / 2);
        top: var(--stepper-marker-size);
        right: auto;
        width: var(--stepper-line-size);
        height: calc(100% + var(--space-4));
    }
}
